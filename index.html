<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Discussion Prompts</title>
  <style>
    body { 
      background: black; color: white; font-size: 24px; font-weight: normal;
      display: flex; align-items: center; justify-content: center; height: 100vh;
      margin: 0; text-align: center;
      transition: background 0.5s, color 0.5s;
    }
    .bold { font-size: 36px; font-weight: bold; }
  </style>
</head>
<body>
  <div id="message">Turn your phone upright to get a question!</div>

  <script>
    const questions = [
      "What meal from your past brings back the fondest memories?",
      "If you could live anywhere you wanted for a year, where would it be?",
      "What’s a favorite game or pastime you enjoyed when you were younger?",
      "Do you prefer being by the water or in the mountains?",
      "Is there something you wish you had learned to do when you were younger?",
      "What was the most surprising change you witnessed in your lifetime?",
      "Do you think people were more neighborly in the past than today?",
      "Which household chore do you actually enjoy doing?",
      "Would you rather spend time gardening or going for a walk?",
      "What’s something simple that always makes you smile?",
      "Is there a skill or hobby you picked up later in life?",
      "Do you enjoy attending large events or small gatherings more?",
      "What do you hope people remember most about you?",
      "Was there a particular age that you enjoyed most in your life?",
      "How do you feel about how people shop now compared to when you were younger?",
      "Would you rather have a long conversation or read a good book?",
      "What is something you still hope to accomplish or try?",
      "Do you prefer planning ahead or being spontaneous?",
      "Is there a holiday that holds special meaning for you? Why?",
      "What’s your favorite season of the year, and what do you love about it?"
    ];

    let hasQuestion = false;

    function getRecentQuestions() {
      const data = localStorage.getItem('recentQuestions');
      return data ? JSON.parse(data) : {};
    }

    function updateRecentQuestions(index) {
      const data = getRecentQuestions();
      data[index] = Date.now();
      localStorage.setItem('recentQuestions', JSON.stringify(data));
    }

    function pickQuestion() {
      const oneHourAgo = Date.now() - 60 * 60 * 1000;
      const data = getRecentQuestions();
      const availableIndexes = questions
        .map((_, i) => i)
        .filter(i => !data[i] || data[i] < oneHourAgo);

      if (availableIndexes.length === 0) {
        localStorage.removeItem('recentQuestions');
        return pickQuestion();
      }

      const chosenIndex = availableIndexes[Math.floor(Math.random() * availableIndexes.length)];
      updateRecentQuestions(chosenIndex);
      return questions[chosenIndex];
    }

    function applyHighlight(show) {
      const msg = document.getElementById('message');
      if (show) {
        if (!hasQuestion) {
          hasQuestion = true;
          const question = pickQuestion();
          document.body.style.background = 'yellow';
          msg.style.color = 'black';
          msg.textContent = question;
          msg.classList.add('bold');
        }
      } else {
        hasQuestion = false;
        document.body.style.background = 'black';
        msg.style.color = 'white';
        msg.textContent = "Turn your phone upright to get a question!";
        msg.classList.remove('bold');
      }
    }

    function handleOrientation() {
      const o = screen.orientation?.type || window.orientation;
      const isPortrait = (typeof o === 'string' && o.includes('portrait')) ||
                         (typeof o === 'number' && (o === 0 || o === 180));
      applyHighlight(isPortrait);
    }

    function handleMotion(event) {
      const x = event.accelerationIncludingGravity?.x || 0;
      const y = event.accelerationIncludingGravity?.y || 0;
      const z = event.accelerationIncludingGravity?.z || 0;
      const isUpright = Math.abs(z) > Math.abs(x) && Math.abs(z) > Math.abs(y) && z > 0;
      applyHighlight(isUpright);
    }

    function initListeners() {
      if ('DeviceMotionEvent' in window) {
        if (typeof DeviceMotionEvent.requestPermission === 'function') {
          DeviceMotionEvent.requestPermission().then(response => {
            if (response === 'granted') {
              window.addEventListener('devicemotion', handleMotion);
            } else {
              fallbackToOrientation();
            }
          }).catch(fallbackToOrientation);
        } else {
          window.addEventListener('devicemotion', handleMotion);
        }
      } else {
        fallbackToOrientation();
      }
    }

    function fallbackToOrientation() {
      if ('screen' in window && 'orientation' in screen) {
        screen.orientation.addEventListener('change', handleOrientation);
        handleOrientation();
      } else if ('orientation' in window) {
        window.addEventListener('orientationchange', handleOrientation);
        handleOrientation();
      } else {
        alert('Orientation detection not supported.');
      }
    }

    initListeners();
  </script>
</body>
</html>